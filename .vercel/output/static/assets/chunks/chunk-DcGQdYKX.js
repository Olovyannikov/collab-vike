import{z as K,t as x,v as M,j as n,aO as ee,aP as se,aQ as te,aR as ae,D as H,aS as oe,aT as re,J as ne,aU as le,aV as F,L as ce,N as de,ah as ie,ak as ue,r as w,aW as me,aX as fe,aY as pe,k as Z,l as he,m as ge,ag as ye,af as xe,f as Me,X as Se,B as $e,M as ve,a3 as j,a5 as S,x as f,aZ as C,Z as X,_ as ke,a4 as be}from"./chunk-aRuK0v6P.js";import"./chunk-DjClQUvI.js";import{H as Pe}from"./chunk-CFcYA5ax.js";import{a as N,$ as we,d as Fe}from"./chunk-CFeoBn27.js";const[je,k]=K("Modal component was not found in tree");var y={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const Ce={},O=x((e,s)=>{const a=M("ModalBody",Ce,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(ee,{ref:s,...c.getStyles("body",{classNames:t,style:r,styles:l,className:o}),...u})});O.classes=y;O.displayName="@mantine/core/ModalBody";const Ne={},B=x((e,s)=>{const a=M("ModalCloseButton",Ne,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(se,{ref:s,...c.getStyles("close",{classNames:t,style:r,styles:l,className:o}),...u})});B.classes=y;B.displayName="@mantine/core/ModalCloseButton";const Oe={},I=x((e,s)=>{const a=M("ModalContent",Oe,e),{classNames:t,className:o,style:r,styles:l,vars:i,children:u,__hidden:c,...d}=a,p=k(),$=p.scrollAreaComponent||te;return n.jsx(ae,{...p.getStyles("content",{className:o,style:r,styles:l,classNames:t}),innerProps:p.getStyles("inner",{className:o,style:r,styles:l,classNames:t}),"data-full-screen":p.fullScreen||void 0,"data-modal-content":!0,"data-hidden":c||void 0,ref:s,...d,children:n.jsx($,{style:{maxHeight:p.fullScreen?"100dvh":`calc(100dvh - (${H(p.yOffset)} * 2))`},children:u})})});I.classes=y;I.displayName="@mantine/core/ModalContent";const Be={},T=x((e,s)=>{const a=M("ModalHeader",Be,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(oe,{ref:s,...c.getStyles("header",{classNames:t,style:r,styles:l,className:o}),...u})});T.classes=y;T.displayName="@mantine/core/ModalHeader";const Ie={},_=x((e,s)=>{const a=M("ModalOverlay",Ie,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(re,{ref:s,...c.getStyles("overlay",{classNames:t,style:r,styles:l,className:o}),...u})});_.classes=y;_.displayName="@mantine/core/ModalOverlay";const Te={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:F("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},_e=ce((e,{radius:s,size:a,yOffset:t,xOffset:o})=>({root:{"--modal-radius":s===void 0?void 0:de(s),"--modal-size":ie(a,"modal-size"),"--modal-y-offset":H(t),"--modal-x-offset":H(o)}})),Q=x((e,s)=>{const a=M("ModalRoot",Te,e),{classNames:t,className:o,style:r,styles:l,unstyled:i,vars:u,yOffset:c,scrollAreaComponent:d,radius:p,fullScreen:$,centered:m,xOffset:D,__staticSelector:R,...E}=a,L=ne({name:R,classes:y,props:a,className:o,style:r,classNames:t,styles:l,unstyled:i,vars:u,varsResolver:_e});return n.jsx(je,{value:{yOffset:c,scrollAreaComponent:d,getStyles:L,fullScreen:$},children:n.jsx(le,{ref:s,...L("root"),"data-full-screen":$||void 0,"data-centered":m||void 0,unstyled:i,...E})})});Q.classes=y;Q.displayName="@mantine/core/ModalRoot";const[Qe,ze]=ue();function q({children:e}){const[s,a]=w.useState([]),[t,o]=w.useState(F("modal"));return n.jsx(Qe,{value:{stack:s,addModal:(r,l)=>{a(i=>[...new Set([...i,r])]),o(i=>typeof l=="number"&&typeof i=="number"?Math.max(i,l):i)},removeModal:r=>a(l=>l.filter(i=>i!==r)),getZIndex:r=>`calc(${t} + ${s.indexOf(r)} + 1)`,currentId:s[s.length-1],maxZIndex:t},children:e})}q.displayName="@mantine/core/ModalStack";const Re={},z=x((e,s)=>{const a=M("ModalTitle",Re,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(me,{ref:s,...c.getStyles("title",{classNames:t,style:r,styles:l,className:o}),...u})});z.classes=y;z.displayName="@mantine/core/ModalTitle";const Ee={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:F("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},h=x((e,s)=>{const{title:a,withOverlay:t,overlayProps:o,withCloseButton:r,closeButtonProps:l,children:i,radius:u,opened:c,stackId:d,zIndex:p,...$}=M("Modal",Ee,e),m=ze(),D=!!a||r,R=m&&d?{closeOnEscape:m.currentId===d,trapFocus:m.currentId===d,zIndex:m.getZIndex(d)}:{},E=t===!1?!1:d&&m?m.currentId===d:c;return w.useEffect(()=>{m&&d&&(c?m.addModal(d,p||F("modal")):m.removeModal(d))},[c,d,p]),n.jsxs(Q,{ref:s,radius:u,opened:c,zIndex:m&&d?m.getZIndex(d):p,...$,...R,children:[t&&n.jsx(_,{visible:E,transitionProps:m&&d?{duration:0}:void 0,...o}),n.jsxs(I,{radius:u,__hidden:m&&d&&c?d!==m.currentId:!1,children:[D&&n.jsxs(T,{children:[a&&n.jsx(z,{children:a}),r&&n.jsx(B,{...l})]}),n.jsx(O,{children:i})]})]})});h.classes=y;h.displayName="@mantine/core/Modal";h.Root=Q;h.Overlay=_;h.Content=I;h.Body=O;h.Header=T;h.Title=z;h.CloseButton=B;h.Stack=q;var He=Array.isArray,Ae="[object Number]";function Ze(e){return typeof e=="number"||fe(e)&&pe(e)==Ae}const fs=Z({sid:"-idf33f",fn:()=>he({effect:ge(()=>({url:"/api/v1/surveys/questions"}))}),name:"getQuestionsQuery",method:"createQuery"}),b=Z({sid:"-dwzmxg",fn:()=>ye({effect:xe(e=>({url:"/api/v1/surveys/answers/submit",method:Pe.POST,body:e}))}),name:"submitAnswersMutation",method:"createMutation"}),Ve=w.memo(({opened:e,onClose:s,onSubmit:a,loading:t})=>n.jsx(h,{opened:e,onClose:s,centered:!0,title:n.jsx(Me,{fz:16,fw:"bold",children:"Завершить тестирование?"}),children:n.jsxs(Se,{gap:"sm",justify:"end",children:[n.jsx($e,{size:"sm",radius:"md",variant:"outline",c:"dark.7",bd:"1px solid var(--mantine-color-dark-7)",onClick:s,children:"Отменить"}),n.jsx(ve,{loading:t,size:"sm",radius:"md",onClick:a,children:"Завершить"})]})}));Ve.displayName="SubmitTestModal";const De=j({name:"scaleFormFieldChanged",sid:"xa64nj"}),Le=j({name:"formPageChanged",sid:"jlkrlc"}),Ge=j({name:"submitScaleForm",sid:"-xmifwm"}),Xe=j({name:"submitModalStateChanged",sid:"-uhnbja"}),J={scaleFormFieldChanged:De,formPageChanged:Le,submitModalStateChanged:Xe,submitScaleForm:Ge},qe=S(null,{name:"$surveyId",sid:"phgjfd"}),Je=S(null,{name:"$preparedQuestions",sid:"twhx53"}),Ue=S(1,{name:"$currentPage",sid:"v6oeh4"}),We=S(null,{name:"$currentQuestion",sid:"-cgeoue"}),Ye=S({answers:[]},{name:"$scaleForm",sid:"-34awu5"}),Ke=S(null,{name:"$currentValue",sid:"vtre3e"}),es=S(0,{name:"$currentProgress",sid:"-1fd944"}),ss=S(!1,{name:"$isSubmitModalShown",sid:"-o7do0x"}),ts=b.$pending,g={$currentPage:Ue,$currentValue:Ke,$currentQuestion:We,$preparedQuestions:Je,$isLoadingState:ts,$scaleForm:Ye,$isSubmitModalShown:ss,$currentProgress:es,$surveyId:qe},{$currentPage:v,$preparedQuestions:G,$currentQuestion:as,$scaleForm:P,$currentValue:U}=g,{scaleFormFieldChanged:W,formPageChanged:V}=J;f({and:[{clock:[v,G],source:{page:v,questions:G},fn:({page:e,questions:s})=>s?s[e-1]:null,target:as}],or:{sid:"-ponxhz"}});f({and:[{clock:W,source:P,fn:(e,s)=>(e.answers[s.index]=s,{...e}),target:P}],or:{sid:"-p5yxbp"}});const Y=Z({sid:"bboj47",fn:()=>Fe(W,250),name:"delayed",method:"delay"});f({and:[{clock:Y,source:v,filter:(e,s)=>!(s.isMultiple||s.isSingle),fn:e=>e+1,target:V}],or:{sid:"-obq8ou"}});f({and:[{clock:Y,source:{form:P,page:v},filter:(e,s)=>!(s.isMultiple||s.isSingle),fn:({form:e,page:s})=>{const a=s-1;return e.answers&&e.answers.length>0&&"value"in e.answers[a].answer&&e.answers[a].answer.value?e.answers[a].answer.value:null},target:U}],or:{sid:"-nvs7hd"}});f({and:[{clock:[P,V],source:{form:P,page:v},fn:({form:{answers:e},page:s},a)=>{var o;const t=(Ze(a)?a:s)-1;return(o=e[t])!=null&&o.answer?e&&e[t].answer&&He(e[t].answer)||e&&e.length>0&&e[t].isSingle?e[t].answer:e&&e.length>0&&"value"in e[t].answer?e[t].answer.value:null:null},target:U}],or:{sid:"-mwldi9"}});f({and:[{clock:V,fn:e=>(window.scrollTo(0,0),e),target:v}],or:{sid:"-lunkkc"}});N({store:we,pickup:C.appStarted});const{$scaleForm:os,$isSubmitModalShown:A}=g,{submitScaleForm:rs,submitModalStateChanged:ns}=J,ls=X(async()=>{await ke("/free-report")},{name:"redirectToFreeReportPageFx",sid:"-r2e0tw"}),cs=X(async e=>{be.show({color:"red",title:"Ошибка!",message:e})},{name:"showSubmitErrorFx",sid:"icm0c9"});f({and:[{clock:ns,source:A,fn:e=>!e,target:A}],or:{sid:"6kdsv9"}});f({and:[{clock:rs,source:os,target:b.start}],or:{sid:"6zs1hd"}});f({and:[{clock:b.finished.success,fn:()=>!1,target:A}],or:{sid:"732t1j"}});f({and:[{clock:b.finished.success,filter:()=>!(window!=null&&window.location.origin.includes("free-report")),fn:({result:e})=>e.id,target:g.$surveyId}],or:{sid:"7hx92a"}});f({and:[{clock:b.finished.success,filter:()=>!(window!=null&&window.location.origin.includes("free-report")),target:ls}],or:{sid:"7xbhoe"}});f({and:[{clock:b.finished.failure,fn:e=>e.error.message,target:cs}],or:{sid:"80m98k"}});f({and:[{clock:g.$scaleForm,source:{questions:g.$preparedQuestions,form:g.$scaleForm},fn:({questions:e,form:{answers:s}})=>Number((s.length/((e==null?void 0:e.length)??0)*100).toFixed(0)),target:g.$currentProgress}],or:{sid:"-hdmfhh"}});N({store:g.$currentPage,pickup:C.appStarted});N({store:g.$scaleForm,pickup:C.appStarted});N({store:g.$currentProgress,pickup:C.appStarted});export{Ve as S,g as T,J as a,Ze as b,fs as g,He as i};
