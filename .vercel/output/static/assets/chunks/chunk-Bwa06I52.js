import{l as se,m as h,n as x,j as n,aG as ae,aH as oe,aI as re,aJ as ne,s as H,aK as le,aL as ce,y as ie,aM as de,x as O,C as ue,D as me,P as fe,au as ge,r as C,aN as pe,a0 as U,a1 as ye,a2 as he,a4 as xe,a3 as Se,a5 as be,Y as ve,_ as Me,ah as $e,aj as je,Q as F,W as S,X as f,aq as we,aa as W,ag as Pe}from"./chunk-CRPQlSIv.js";import{a as G}from"./chunk-DXMN5A6d.js";import{i as Ce,a as ke,b as Oe,f as Fe,r as Te}from"./chunk-C78j02Lg.js";const[Ne,$]=se("Modal component was not found in tree");var y={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const Be={},T=h((e,t)=>{const s=x("ModalBody",Be,e),{classNames:a,className:o,style:r,styles:l,vars:d,...u}=s,c=$();return n.jsx(ae,{ref:t,...c.getStyles("body",{classNames:a,style:r,styles:l,className:o}),...u})});T.classes=y;T.displayName="@mantine/core/ModalBody";const Ie={},N=h((e,t)=>{const s=x("ModalCloseButton",Ie,e),{classNames:a,className:o,style:r,styles:l,vars:d,...u}=s,c=$();return n.jsx(oe,{ref:t,...c.getStyles("close",{classNames:a,style:r,styles:l,className:o}),...u})});N.classes=y;N.displayName="@mantine/core/ModalCloseButton";const Re={},B=h((e,t)=>{const s=x("ModalContent",Re,e),{classNames:a,className:o,style:r,styles:l,vars:d,children:u,__hidden:c,...i}=s,g=$(),b=g.scrollAreaComponent||re;return n.jsx(ne,{...g.getStyles("content",{className:o,style:r,styles:l,classNames:a}),innerProps:g.getStyles("inner",{className:o,style:r,styles:l,classNames:a}),"data-full-screen":g.fullScreen||void 0,"data-modal-content":!0,"data-hidden":c||void 0,ref:t,...i,children:n.jsx(b,{style:{maxHeight:g.fullScreen?"100dvh":`calc(100dvh - (${H(g.yOffset)} * 2))`},children:u})})});B.classes=y;B.displayName="@mantine/core/ModalContent";const _e={},I=h((e,t)=>{const s=x("ModalHeader",_e,e),{classNames:a,className:o,style:r,styles:l,vars:d,...u}=s,c=$();return n.jsx(le,{ref:t,...c.getStyles("header",{classNames:a,style:r,styles:l,className:o}),...u})});I.classes=y;I.displayName="@mantine/core/ModalHeader";const Qe={},R=h((e,t)=>{const s=x("ModalOverlay",Qe,e),{classNames:a,className:o,style:r,styles:l,vars:d,...u}=s,c=$();return n.jsx(ce,{ref:t,...c.getStyles("overlay",{classNames:a,style:r,styles:l,className:o}),...u})});R.classes=y;R.displayName="@mantine/core/ModalOverlay";const ze={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:O("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},Ee=ue((e,{radius:t,size:s,yOffset:a,xOffset:o})=>({root:{"--modal-radius":t===void 0?void 0:me(t),"--modal-size":fe(s,"modal-size"),"--modal-y-offset":H(a),"--modal-x-offset":H(o)}})),_=h((e,t)=>{const s=x("ModalRoot",ze,e),{classNames:a,className:o,style:r,styles:l,unstyled:d,vars:u,yOffset:c,scrollAreaComponent:i,radius:g,fullScreen:b,centered:m,xOffset:Z,__staticSelector:z,...E}=s,q=ie({name:z,classes:y,props:s,className:o,style:r,classNames:a,styles:l,unstyled:d,vars:u,varsResolver:Ee});return n.jsx(Ne,{value:{yOffset:c,scrollAreaComponent:i,getStyles:q,fullScreen:b},children:n.jsx(de,{ref:t,...q("root"),"data-full-screen":b||void 0,"data-centered":m||void 0,unstyled:d,...E})})});_.classes=y;_.displayName="@mantine/core/ModalRoot";const[He,Ae]=ge();function J({children:e}){const[t,s]=C.useState([]),[a,o]=C.useState(O("modal"));return n.jsx(He,{value:{stack:t,addModal:(r,l)=>{s(d=>[...new Set([...d,r])]),o(d=>typeof l=="number"&&typeof d=="number"?Math.max(d,l):d)},removeModal:r=>s(l=>l.filter(d=>d!==r)),getZIndex:r=>`calc(${a} + ${t.indexOf(r)} + 1)`,currentId:t[t.length-1],maxZIndex:a},children:e})}J.displayName="@mantine/core/ModalStack";const Ue={},Q=h((e,t)=>{const s=x("ModalTitle",Ue,e),{classNames:a,className:o,style:r,styles:l,vars:d,...u}=s,c=$();return n.jsx(pe,{ref:t,...c.getStyles("title",{classNames:a,style:r,styles:l,className:o}),...u})});Q.classes=y;Q.displayName="@mantine/core/ModalTitle";const Ve={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:O("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},p=h((e,t)=>{const{title:s,withOverlay:a,overlayProps:o,withCloseButton:r,closeButtonProps:l,children:d,radius:u,opened:c,stackId:i,zIndex:g,...b}=x("Modal",Ve,e),m=Ae(),Z=!!s||r,z=m&&i?{closeOnEscape:m.currentId===i,trapFocus:m.currentId===i,zIndex:m.getZIndex(i)}:{},E=a===!1?!1:i&&m?m.currentId===i:c;return C.useEffect(()=>{m&&i&&(c?m.addModal(i,g||O("modal")):m.removeModal(i))},[c,i,g]),n.jsxs(_,{ref:t,radius:u,opened:c,zIndex:m&&i?m.getZIndex(i):g,...b,...z,children:[a&&n.jsx(R,{visible:E,transitionProps:m&&i?{duration:0}:void 0,...o}),n.jsxs(B,{radius:u,__hidden:m&&i&&c?i!==m.currentId:!1,children:[Z&&n.jsxs(I,{children:[s&&n.jsx(Q,{children:s}),r&&n.jsx(N,{...l})]}),n.jsx(T,{children:d})]})]})});p.classes=y;p.displayName="@mantine/core/Modal";p.Root=_;p.Overlay=R;p.Content=B;p.Body=T;p.Header=I;p.Title=Q;p.CloseButton=N;p.Stack=J;const Ft=U({sid:"-idf33f",fn:()=>ye({effect:he(()=>({url:"/api/v1/surveys/questions"}))}),name:"getQuestionsQuery",method:"createQuery"}),P=U({sid:"-dwzmxg",fn:()=>xe({effect:Se(e=>({url:"/api/v1/surveys/answers/submit",method:be.POST,body:e}))}),name:"submitAnswersMutation",method:"createMutation"}),Ze=C.memo(({opened:e,onClose:t,onSubmit:s,loading:a})=>n.jsx(p,{opened:e,onClose:t,centered:!0,title:n.jsx(ve,{fz:16,fw:"bold",children:"Завершить тестирование?"}),children:n.jsxs(Me,{gap:"sm",justify:"end",children:[n.jsx($e,{size:"sm",radius:"md",variant:"outline",c:"dark.7",bd:"1px solid var(--mantine-color-dark-7)",onClick:t,children:"Отменить"}),n.jsx(je,{loading:a,size:"sm",radius:"md",onClick:s,children:"Завершить"})]})}));Ze.displayName="SubmitTestModal";const qe=F({name:"scaleFormFieldChanged",sid:"xa64nj"}),Ge=F({name:"formPageChanged",sid:"jlkrlc"}),Le=F({name:"submitScaleForm",sid:"-xmifwm"}),De=F({name:"submitModalStateChanged",sid:"-uhnbja"}),K={scaleFormFieldChanged:qe,formPageChanged:Ge,submitModalStateChanged:De,submitScaleForm:Le},We=S(null,{name:"$preparedQuestions",sid:"tfgaqw"}),Je=S(1,{name:"$currentPage",sid:"-bb8l64"}),Ke=S(null,{name:"$currentQuestion",sid:"-cxgb8l"}),Xe=S({answers:[]},{name:"$scaleForm",sid:"-3lcj8c"}),Ye=S(null,{name:"$currentValue",sid:"vcprp7"}),et=S(0,{name:"$currentProgress",sid:"-1wevib"}),tt=S(!1,{name:"$isSubmitModalShown",sid:"-oofaf4"}),st=P.$pending,v={$currentPage:Je,$currentValue:Ye,$currentQuestion:Ke,$preparedQuestions:We,$isLoadingState:st,$scaleForm:Xe,$isSubmitModalShown:tt,$currentProgress:et};var at=typeof global=="object"&&global&&global.Object===Object&&global,ot=typeof self=="object"&&self&&self.Object===Object&&self,rt=at||ot||Function("return this")(),k=rt.Symbol,X=Object.prototype,nt=X.hasOwnProperty,lt=X.toString,j=k?k.toStringTag:void 0;function ct(e){var t=nt.call(e,j),s=e[j];try{e[j]=void 0;var a=!0}catch{}var o=lt.call(e);return a&&(t?e[j]=s:delete e[j]),o}var it=Object.prototype,dt=it.toString;function ut(e){return dt.call(e)}var mt="[object Null]",ft="[object Undefined]",L=k?k.toStringTag:void 0;function gt(e){return e==null?e===void 0?ft:mt:L&&L in Object(e)?ct(e):ut(e)}function pt(e){return e!=null&&typeof e=="object"}var yt=Array.isArray,ht="[object Number]";function xt(e){return typeof e=="number"||pt(e)&&gt(e)==ht}const{$currentPage:M,$preparedQuestions:D,$currentQuestion:St,$scaleForm:w,$currentValue:Y}=v,{scaleFormFieldChanged:ee,formPageChanged:V}=K;f({and:[{clock:[M,D],source:{page:M,questions:D},fn:({page:e,questions:t})=>t?t[e-1]:null,target:St}],or:{sid:"-pqbba2"}});f({and:[{clock:ee,source:w,fn:(e,t)=>(e.answers[t.index]=t,{...e}),target:w}],or:{sid:"-p7mb3s"}});const te=U({sid:"-1eech",fn:()=>we(ee,1e3),name:"delayed",method:"delay"});f({and:[{clock:te,source:M,filter:(e,t)=>!(t.isMultiple||t.isSingle),fn:e=>e+1,target:V}],or:{sid:"-ooxaxi"}});f({and:[{clock:te,source:{form:w,page:M},filter:(e,t)=>!(t.isMultiple||t.isSingle),fn:({form:e,page:t})=>{const s=t-1;return e.answers&&e.answers.length>0&&"value"in e.answers[s].answer&&e.answers[s].answer.value?e.answers[s].answer.value:null},target:Y}],or:{sid:"-o8z9q1"}});f({and:[{clock:[w,V],source:{form:w,page:M},fn:({form:{answers:e},page:t},s)=>{var o;const a=(xt(s)?s:t)-1;return(o=e[a])!=null&&o.answer?e&&e[a].answer&&yt(e[a].answer)||e&&e.length>0&&e[a].isSingle?e[a].answer:e&&e.length>0&&"value"in e[a].answer?e[a].answer.value:null:null},target:Y}],or:{sid:"-n9sfqx"}});f({and:[{clock:V,fn:e=>(window.scrollTo(0,0),e),target:M}],or:{sid:"-lwaycf"}});function bt(e,t){const s=`[${t}(url)] Invalid URL ${e}`;return G(Ce(e),s),e.startsWith(location.origin)&&(e=e.slice(location.origin.length)),G(e.startsWith("/")||ke(e),s),e}Oe();async function vt(e,{keepScrollPosition:t=!1,overwriteLastHistoryEntry:s=!1,pageContext:a}={}){bt(e,"navigate"),await Fe,await Te({scrollTarget:{preserveScroll:t},urlOriginal:e,overwriteLastHistoryEntry:s,isBackwardNavigation:!1,pageContextInitClient:a})}const{$scaleForm:Mt,$isSubmitModalShown:A}=v,{submitScaleForm:$t,submitModalStateChanged:jt}=K,wt=W(async()=>{await vt("/free-report")},{name:"redirectToFreeReportPageFx",sid:"-r2e0tw"}),Pt=W(async e=>{Pe.show({color:"red",title:"Ошибка!",message:e})},{name:"showSubmitErrorFx",sid:"icm0c9"});f({and:[{clock:jt,source:A,fn:e=>!e,target:A}],or:{sid:"6kdsv9"}});f({and:[{clock:$t,source:Mt,target:P.start}],or:{sid:"6zs1hd"}});f({and:[{clock:P.finished.success,fn:()=>!1,target:A}],or:{sid:"732t1j"}});f({and:[{clock:P.finished.success,filter:()=>!(window!=null&&window.location.origin.includes("free-report")),target:wt}],or:{sid:"7hx92a"}});f({and:[{clock:P.finished.failure,fn:e=>e.error.message,target:Pt}],or:{sid:"7l80mg"}});f({and:[{clock:v.$scaleForm,source:{questions:v.$preparedQuestions,form:v.$scaleForm},fn:({questions:e,form:{answers:t}})=>Number((t.length/((e==null?void 0:e.length)??0)*100).toFixed(0)),target:v.$currentProgress}],or:{sid:"-hdmfhh"}});export{Ze as S,v as T,K as a,Ft as g,yt as i};
