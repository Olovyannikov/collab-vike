import{t as ae,n as x,p as S,j as n,at as re,au as oe,av as ne,aw as le,v as V,ax as ce,ay as de,y as ie,az as ue,ag as O,A as me,D as fe,$ as pe,a2 as ge,r as P,aA as ye,k as G,G as he,K as C,M as $,x as f,aB as T,H as J,L as xe}from"./chunk-krdQHAUy.js";import{B as Se,M as $e,n as be}from"./chunk-BW9xlyfv.js";import"./chunk-ASQl6zNv.js";import{a as Me}from"./chunk-lN7CvV0g.js";import{I as ve,c as je,j as ke,a as we}from"./chunk-YhYFzeYz.js";import{H as Pe}from"./chunk-CFcYA5ax.js";import{a as N,$ as Fe,d as Oe}from"./chunk-CyN2cKcU.js";const[Ce,v]=ae("Modal component was not found in tree");var h={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const Te={},B=x((e,t)=>{const a=S("ModalBody",Te,e),{classNames:s,className:r,style:o,styles:l,vars:i,...u}=a,c=v();return n.jsx(re,{ref:t,...c.getStyles("body",{classNames:s,style:o,styles:l,className:r}),...u})});B.classes=h;B.displayName="@mantine/core/ModalBody";const Ne={},I=x((e,t)=>{const a=S("ModalCloseButton",Ne,e),{classNames:s,className:r,style:o,styles:l,vars:i,...u}=a,c=v();return n.jsx(oe,{ref:t,...c.getStyles("close",{classNames:s,style:o,styles:l,className:r}),...u})});I.classes=h;I.displayName="@mantine/core/ModalCloseButton";const Be={},_=x((e,t)=>{const a=S("ModalContent",Be,e),{classNames:s,className:r,style:o,styles:l,vars:i,children:u,__hidden:c,...d}=a,p=v(),b=p.scrollAreaComponent||ne;return n.jsx(le,{...p.getStyles("content",{className:r,style:o,styles:l,classNames:s}),innerProps:p.getStyles("inner",{className:r,style:o,styles:l,classNames:s}),"data-full-screen":p.fullScreen||void 0,"data-modal-content":!0,"data-hidden":c||void 0,ref:t,...d,children:n.jsx(b,{style:{maxHeight:p.fullScreen?"100dvh":`calc(100dvh - (${V(p.yOffset)} * 2))`},children:u})})});_.classes=h;_.displayName="@mantine/core/ModalContent";const Ie={},z=x((e,t)=>{const a=S("ModalHeader",Ie,e),{classNames:s,className:r,style:o,styles:l,vars:i,...u}=a,c=v();return n.jsx(ce,{ref:t,...c.getStyles("header",{classNames:s,style:o,styles:l,className:r}),...u})});z.classes=h;z.displayName="@mantine/core/ModalHeader";const _e={},Q=x((e,t)=>{const a=S("ModalOverlay",_e,e),{classNames:s,className:r,style:o,styles:l,vars:i,...u}=a,c=v();return n.jsx(de,{ref:t,...c.getStyles("overlay",{classNames:s,style:o,styles:l,className:r}),...u})});Q.classes=h;Q.displayName="@mantine/core/ModalOverlay";const ze={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:O("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},Qe=me((e,{radius:t,size:a,yOffset:s,xOffset:r})=>({root:{"--modal-radius":t===void 0?void 0:fe(t),"--modal-size":pe(a,"modal-size"),"--modal-y-offset":V(s),"--modal-x-offset":V(r)}})),R=x((e,t)=>{const a=S("ModalRoot",ze,e),{classNames:s,className:r,style:o,styles:l,unstyled:i,vars:u,yOffset:c,scrollAreaComponent:d,radius:p,fullScreen:b,centered:m,xOffset:L,__staticSelector:A,...E}=a,q=ie({name:A,classes:h,props:a,className:r,style:o,classNames:s,styles:l,unstyled:i,vars:u,varsResolver:Qe});return n.jsx(Ce,{value:{yOffset:c,scrollAreaComponent:d,getStyles:q,fullScreen:b},children:n.jsx(ue,{ref:t,...q("root"),"data-full-screen":b||void 0,"data-centered":m||void 0,unstyled:i,...E})})});R.classes=h;R.displayName="@mantine/core/ModalRoot";const[Re,He]=ge();function W({children:e}){const[t,a]=P.useState([]),[s,r]=P.useState(O("modal"));return n.jsx(Re,{value:{stack:t,addModal:(o,l)=>{a(i=>[...new Set([...i,o])]),r(i=>typeof l=="number"&&typeof i=="number"?Math.max(i,l):i)},removeModal:o=>a(l=>l.filter(i=>i!==o)),getZIndex:o=>`calc(${s} + ${t.indexOf(o)} + 1)`,currentId:t[t.length-1],maxZIndex:s},children:e})}W.displayName="@mantine/core/ModalStack";const Ae={},H=x((e,t)=>{const a=S("ModalTitle",Ae,e),{classNames:s,className:r,style:o,styles:l,vars:i,...u}=a,c=v();return n.jsx(ye,{ref:t,...c.getStyles("title",{classNames:s,style:o,styles:l,className:r}),...u})});H.classes=h;H.displayName="@mantine/core/ModalTitle";const Ee={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:O("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},g=x((e,t)=>{const{title:a,withOverlay:s,overlayProps:r,withCloseButton:o,closeButtonProps:l,children:i,radius:u,opened:c,stackId:d,zIndex:p,...b}=S("Modal",Ee,e),m=He(),L=!!a||o,A=m&&d?{closeOnEscape:m.currentId===d,trapFocus:m.currentId===d,zIndex:m.getZIndex(d)}:{},E=s===!1?!1:d&&m?m.currentId===d:c;return P.useEffect(()=>{m&&d&&(c?m.addModal(d,p||O("modal")):m.removeModal(d))},[c,d,p]),n.jsxs(R,{ref:t,radius:u,opened:c,zIndex:m&&d?m.getZIndex(d):p,...b,...A,children:[s&&n.jsx(Q,{visible:E,transitionProps:m&&d?{duration:0}:void 0,...r}),n.jsxs(_,{radius:u,__hidden:m&&d&&c?d!==m.currentId:!1,children:[L&&n.jsxs(z,{children:[a&&n.jsx(H,{children:a}),o&&n.jsx(I,{...l})]}),n.jsx(B,{children:i})]})]})});g.classes=h;g.displayName="@mantine/core/Modal";g.Root=R;g.Overlay=Q;g.Content=_;g.Body=B;g.Header=z;g.Title=H;g.CloseButton=I;g.Stack=W;const Tt=G({sid:"-idf33f",fn:()=>ve({effect:je(()=>({url:"/api/v1/surveys/questions"}))}),name:"getQuestionsQuery",method:"createQuery"}),j=G({sid:"-dwzmxg",fn:()=>ke({effect:we(e=>({url:"/api/v1/surveys/answers/submit",method:Pe.POST,body:e}))}),name:"submitAnswersMutation",method:"createMutation"}),Ve=P.memo(({opened:e,onClose:t,onSubmit:a,loading:s})=>n.jsx(g,{opened:e,onClose:t,centered:!0,title:n.jsx(Me,{fz:16,fw:"bold",children:"Завершить тестирование?"}),children:n.jsxs(he,{gap:"sm",justify:"end",children:[n.jsx(Se,{size:"sm",radius:"md",variant:"outline",c:"dark.7",bd:"1px solid var(--mantine-color-dark-7)",onClick:t,children:"Отменить"}),n.jsx($e,{loading:s,size:"sm",radius:"md",onClick:a,children:"Завершить"})]})}));Ve.displayName="SubmitTestModal";const Ze=C({name:"scaleFormFieldChanged",sid:"xa64nj"}),Ge=C({name:"formPageChanged",sid:"jlkrlc"}),De=C({name:"submitScaleForm",sid:"-xmifwm"}),Le=C({name:"submitModalStateChanged",sid:"-uhnbja"}),X={scaleFormFieldChanged:Ze,formPageChanged:Ge,submitModalStateChanged:Le,submitScaleForm:De},qe=$(null,{name:"$surveyId",sid:"phgjfd"}),Ke=$(null,{name:"$preparedQuestions",sid:"twhx53"}),Ue=$(1,{name:"$currentPage",sid:"v6oeh4"}),Je=$(null,{name:"$currentQuestion",sid:"-cgeoue"}),We=$({answers:[]},{name:"$scaleForm",sid:"-34awu5"}),Xe=$(null,{name:"$currentValue",sid:"vtre3e"}),Ye=$(0,{name:"$currentProgress",sid:"-1fd944"}),et=$(!1,{name:"$isSubmitModalShown",sid:"-o7do0x"}),tt=j.$pending,y={$currentPage:Ue,$currentValue:Xe,$currentQuestion:Je,$preparedQuestions:Ke,$isLoadingState:tt,$scaleForm:We,$isSubmitModalShown:et,$currentProgress:Ye,$surveyId:qe};var st=typeof global=="object"&&global&&global.Object===Object&&global,at=typeof self=="object"&&self&&self.Object===Object&&self,rt=st||at||Function("return this")(),F=rt.Symbol,Y=Object.prototype,ot=Y.hasOwnProperty,nt=Y.toString,k=F?F.toStringTag:void 0;function lt(e){var t=ot.call(e,k),a=e[k];try{e[k]=void 0;var s=!0}catch{}var r=nt.call(e);return s&&(t?e[k]=a:delete e[k]),r}var ct=Object.prototype,dt=ct.toString;function it(e){return dt.call(e)}var ut="[object Null]",mt="[object Undefined]",K=F?F.toStringTag:void 0;function ft(e){return e==null?e===void 0?mt:ut:K&&K in Object(e)?lt(e):it(e)}function pt(e){return e!=null&&typeof e=="object"}var gt=Array.isArray,yt="[object Number]";function ht(e){return typeof e=="number"||pt(e)&&ft(e)==yt}const{$currentPage:M,$preparedQuestions:U,$currentQuestion:xt,$scaleForm:w,$currentValue:ee}=y,{scaleFormFieldChanged:te,formPageChanged:D}=X;f({and:[{clock:[M,U],source:{page:M,questions:U},fn:({page:e,questions:t})=>t?t[e-1]:null,target:xt}],or:{sid:"-ponxhz"}});f({and:[{clock:te,source:w,fn:(e,t)=>(e.answers[t.index]=t,{...e}),target:w}],or:{sid:"-p5yxbp"}});const se=G({sid:"bboj47",fn:()=>Oe(te,250),name:"delayed",method:"delay"});f({and:[{clock:se,source:M,filter:(e,t)=>!(t.isMultiple||t.isSingle),fn:e=>e+1,target:D}],or:{sid:"-obq8ou"}});f({and:[{clock:se,source:{form:w,page:M},filter:(e,t)=>!(t.isMultiple||t.isSingle),fn:({form:e,page:t})=>{const a=t-1;return e.answers&&e.answers.length>0&&"value"in e.answers[a].answer&&e.answers[a].answer.value?e.answers[a].answer.value:null},target:ee}],or:{sid:"-nvs7hd"}});f({and:[{clock:[w,D],source:{form:w,page:M},fn:({form:{answers:e},page:t},a)=>{var r;const s=(ht(a)?a:t)-1;return(r=e[s])!=null&&r.answer?e&&e[s].answer&&gt(e[s].answer)||e&&e.length>0&&e[s].isSingle?e[s].answer:e&&e.length>0&&"value"in e[s].answer?e[s].answer.value:null:null},target:ee}],or:{sid:"-mwldi9"}});f({and:[{clock:D,fn:e=>(window.scrollTo(0,0),e),target:M}],or:{sid:"-lunkkc"}});N({store:Fe,pickup:T.appStarted});const{$scaleForm:St,$isSubmitModalShown:Z}=y,{submitScaleForm:$t,submitModalStateChanged:bt}=X,Mt=J(async()=>{await be("/free-report")},{name:"redirectToFreeReportPageFx",sid:"-r2e0tw"}),vt=J(async e=>{xe.show({color:"red",title:"Ошибка!",message:e})},{name:"showSubmitErrorFx",sid:"icm0c9"});f({and:[{clock:bt,source:Z,fn:e=>!e,target:Z}],or:{sid:"6kdsv9"}});f({and:[{clock:$t,source:St,target:j.start}],or:{sid:"6zs1hd"}});f({and:[{clock:j.finished.success,fn:()=>!1,target:Z}],or:{sid:"732t1j"}});f({and:[{clock:j.finished.success,filter:()=>!(window!=null&&window.location.origin.includes("free-report")),fn:({result:e})=>e.id,target:y.$surveyId}],or:{sid:"7hx92a"}});f({and:[{clock:j.finished.success,filter:()=>!(window!=null&&window.location.origin.includes("free-report")),target:Mt}],or:{sid:"7xbhoe"}});f({and:[{clock:j.finished.failure,fn:e=>e.error.message,target:vt}],or:{sid:"80m98k"}});f({and:[{clock:y.$scaleForm,source:{questions:y.$preparedQuestions,form:y.$scaleForm},fn:({questions:e,form:{answers:t}})=>Number((t.length/((e==null?void 0:e.length)??0)*100).toFixed(0)),target:y.$currentProgress}],or:{sid:"-hdmfhh"}});N({store:y.$currentPage,pickup:T.appStarted});N({store:y.$scaleForm,pickup:T.appStarted});N({store:y.$currentProgress,pickup:T.appStarted});export{Ve as S,y as T,X as a,ht as b,Tt as g,gt as i};
