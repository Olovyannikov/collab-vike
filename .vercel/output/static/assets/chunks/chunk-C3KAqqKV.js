import{n as Y,g as x,h as M,j as n,aw as ee,ax as se,ay as te,az as ae,p as H,aA as oe,aB as re,s as ne,aC as le,a2 as F,v as ce,w as de,ag as ie,ar as ue,r as b,aD as me,y as V,G as pe,I as C,K as $,F as p,aE as j,E as J,J as fe}from"./chunk-CTUfgmOZ.js";import{B as he,M as ge,n as ye}from"./chunk-CJF8S2K6.js";import"./chunk-ASQl6zNv.js";import{a as xe}from"./chunk-1r0-WiQF.js";import{I as Me,c as $e,j as Se,a as ve}from"./chunk-Bus-W5S1.js";import{H as ke}from"./chunk-CFcYA5ax.js";import{a as N,$ as we,d as Pe}from"./chunk-qjiBw4dd.js";import{i as be}from"./chunk-Dj8PVZaI.js";const[Fe,k]=Y("Modal component was not found in tree");var y={root:"m_9df02822",content:"m_54c44539",inner:"m_1f958f16",header:"m_d0e2b9cd"};const Ce={},B=x((e,s)=>{const a=M("ModalBody",Ce,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(ee,{ref:s,...c.getStyles("body",{classNames:t,style:r,styles:l,className:o}),...u})});B.classes=y;B.displayName="@mantine/core/ModalBody";const je={},I=x((e,s)=>{const a=M("ModalCloseButton",je,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(se,{ref:s,...c.getStyles("close",{classNames:t,style:r,styles:l,className:o}),...u})});I.classes=y;I.displayName="@mantine/core/ModalCloseButton";const Ne={},O=x((e,s)=>{const a=M("ModalContent",Ne,e),{classNames:t,className:o,style:r,styles:l,vars:i,children:u,__hidden:c,...d}=a,f=k(),S=f.scrollAreaComponent||te;return n.jsx(ae,{...f.getStyles("content",{className:o,style:r,styles:l,classNames:t}),innerProps:f.getStyles("inner",{className:o,style:r,styles:l,classNames:t}),"data-full-screen":f.fullScreen||void 0,"data-modal-content":!0,"data-hidden":c||void 0,ref:s,...d,children:n.jsx(S,{style:{maxHeight:f.fullScreen?"100dvh":`calc(100dvh - (${H(f.yOffset)} * 2))`},children:u})})});O.classes=y;O.displayName="@mantine/core/ModalContent";const Be={},T=x((e,s)=>{const a=M("ModalHeader",Be,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(oe,{ref:s,...c.getStyles("header",{classNames:t,style:r,styles:l,className:o}),...u})});T.classes=y;T.displayName="@mantine/core/ModalHeader";const Ie={},_=x((e,s)=>{const a=M("ModalOverlay",Ie,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(re,{ref:s,...c.getStyles("overlay",{classNames:t,style:r,styles:l,className:o}),...u})});_.classes=y;_.displayName="@mantine/core/ModalOverlay";const Oe={__staticSelector:"Modal",closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:F("modal"),transitionProps:{duration:200,transition:"fade-down"},yOffset:"5dvh"},Te=ce((e,{radius:s,size:a,yOffset:t,xOffset:o})=>({root:{"--modal-radius":s===void 0?void 0:de(s),"--modal-size":ie(a,"modal-size"),"--modal-y-offset":H(t),"--modal-x-offset":H(o)}})),z=x((e,s)=>{const a=M("ModalRoot",Oe,e),{classNames:t,className:o,style:r,styles:l,unstyled:i,vars:u,yOffset:c,scrollAreaComponent:d,radius:f,fullScreen:S,centered:m,xOffset:D,__staticSelector:E,...R}=a,G=ne({name:E,classes:y,props:a,className:o,style:r,classNames:t,styles:l,unstyled:i,vars:u,varsResolver:Te});return n.jsx(Fe,{value:{yOffset:c,scrollAreaComponent:d,getStyles:G,fullScreen:S},children:n.jsx(le,{ref:s,...G("root"),"data-full-screen":S||void 0,"data-centered":m||void 0,unstyled:i,...R})})});z.classes=y;z.displayName="@mantine/core/ModalRoot";const[_e,ze]=ue();function K({children:e}){const[s,a]=b.useState([]),[t,o]=b.useState(F("modal"));return n.jsx(_e,{value:{stack:s,addModal:(r,l)=>{a(i=>[...new Set([...i,r])]),o(i=>typeof l=="number"&&typeof i=="number"?Math.max(i,l):i)},removeModal:r=>a(l=>l.filter(i=>i!==r)),getZIndex:r=>`calc(${t} + ${s.indexOf(r)} + 1)`,currentId:s[s.length-1],maxZIndex:t},children:e})}K.displayName="@mantine/core/ModalStack";const Qe={},Q=x((e,s)=>{const a=M("ModalTitle",Qe,e),{classNames:t,className:o,style:r,styles:l,vars:i,...u}=a,c=k();return n.jsx(me,{ref:s,...c.getStyles("title",{classNames:t,style:r,styles:l,className:o}),...u})});Q.classes=y;Q.displayName="@mantine/core/ModalTitle";const Ee={closeOnClickOutside:!0,withinPortal:!0,lockScroll:!0,trapFocus:!0,returnFocus:!0,closeOnEscape:!0,keepMounted:!1,zIndex:F("modal"),transitionProps:{duration:200,transition:"fade-down"},withOverlay:!0,withCloseButton:!0},h=x((e,s)=>{const{title:a,withOverlay:t,overlayProps:o,withCloseButton:r,closeButtonProps:l,children:i,radius:u,opened:c,stackId:d,zIndex:f,...S}=M("Modal",Ee,e),m=ze(),D=!!a||r,E=m&&d?{closeOnEscape:m.currentId===d,trapFocus:m.currentId===d,zIndex:m.getZIndex(d)}:{},R=t===!1?!1:d&&m?m.currentId===d:c;return b.useEffect(()=>{m&&d&&(c?m.addModal(d,f||F("modal")):m.removeModal(d))},[c,d,f]),n.jsxs(z,{ref:s,radius:u,opened:c,zIndex:m&&d?m.getZIndex(d):f,...S,...E,children:[t&&n.jsx(_,{visible:R,transitionProps:m&&d?{duration:0}:void 0,...o}),n.jsxs(O,{radius:u,__hidden:m&&d&&c?d!==m.currentId:!1,children:[D&&n.jsxs(T,{children:[a&&n.jsx(Q,{children:a}),r&&n.jsx(I,{...l})]}),n.jsx(B,{children:i})]})]})});h.classes=y;h.displayName="@mantine/core/Modal";h.Root=z;h.Overlay=_;h.Content=O;h.Body=B;h.Header=T;h.Title=Q;h.CloseButton=I;h.Stack=K;var Re=Array.isArray;const fs=V({sid:"-idf33f",fn:()=>Me({effect:$e(()=>({url:"/api/v1/surveys/questions"}))}),name:"getQuestionsQuery",method:"createQuery"}),w=V({sid:"-dwzmxg",fn:()=>Se({effect:ve(e=>({url:"/api/v1/surveys/answers/submit",method:ke.POST,body:e}))}),name:"submitAnswersMutation",method:"createMutation"}),He=b.memo(({opened:e,onClose:s,onSubmit:a,loading:t})=>n.jsx(h,{opened:e,onClose:s,centered:!0,title:n.jsx(xe,{fz:16,fw:"bold",children:"Завершить тестирование?"}),children:n.jsxs(pe,{gap:"sm",justify:"end",children:[n.jsx(he,{size:"sm",radius:"md",variant:"outline",c:"dark.7",bd:"1px solid var(--mantine-color-dark-7)",onClick:s,children:"Отменить"}),n.jsx(ge,{loading:t,size:"sm",radius:"md",onClick:a,children:"Завершить"})]})}));He.displayName="SubmitTestModal";const Ae=C({name:"scaleFormFieldChanged",sid:"xa64nj"}),Ve=C({name:"formPageChanged",sid:"jlkrlc"}),Ze=C({name:"submitScaleForm",sid:"-xmifwm"}),De=C({name:"submitModalStateChanged",sid:"-uhnbja"}),L={scaleFormFieldChanged:Ae,formPageChanged:Ve,submitModalStateChanged:De,submitScaleForm:Ze},Ge=$(null,{name:"$surveyId",sid:"phgjfd"}),qe=$(null,{name:"$preparedQuestions",sid:"twhx53"}),Je=$(1,{name:"$currentPage",sid:"v6oeh4"}),Ke=$(null,{name:"$currentQuestion",sid:"-cgeoue"}),Le=$({answers:[]},{name:"$scaleForm",sid:"-34awu5"}),Ue=$(null,{name:"$currentValue",sid:"vtre3e"}),We=$(0,{name:"$currentProgress",sid:"-1fd944"}),Xe=$(!1,{name:"$isSubmitModalShown",sid:"-o7do0x"}),Ye=w.$pending,g={$currentPage:Je,$currentValue:Ue,$currentQuestion:Ke,$preparedQuestions:qe,$isLoadingState:Ye,$scaleForm:Le,$isSubmitModalShown:Xe,$currentProgress:We,$surveyId:Ge},{$currentPage:v,$preparedQuestions:q,$currentQuestion:es,$scaleForm:P,$currentValue:U}=g,{scaleFormFieldChanged:W,formPageChanged:Z}=L;p({and:[{clock:[v,q],source:{page:v,questions:q},fn:({page:e,questions:s})=>s?s[e-1]:null,target:es}],or:{sid:"-ponxhz"}});p({and:[{clock:W,source:P,fn:(e,s)=>(e.answers[s.index]=s,{...e}),target:P}],or:{sid:"-p5yxbp"}});const X=V({sid:"bboj47",fn:()=>Pe(W,1e3),name:"delayed",method:"delay"});p({and:[{clock:X,source:v,filter:(e,s)=>!(s.isMultiple||s.isSingle),fn:e=>e+1,target:Z}],or:{sid:"-obq8ou"}});p({and:[{clock:X,source:{form:P,page:v},filter:(e,s)=>!(s.isMultiple||s.isSingle),fn:({form:e,page:s})=>{const a=s-1;return e.answers&&e.answers.length>0&&"value"in e.answers[a].answer&&e.answers[a].answer.value?e.answers[a].answer.value:null},target:U}],or:{sid:"-nvs7hd"}});p({and:[{clock:[P,Z],source:{form:P,page:v},fn:({form:{answers:e},page:s},a)=>{var o;const t=(be(a)?a:s)-1;return(o=e[t])!=null&&o.answer?e&&e[t].answer&&Re(e[t].answer)||e&&e.length>0&&e[t].isSingle?e[t].answer:e&&e.length>0&&"value"in e[t].answer?e[t].answer.value:null:null},target:U}],or:{sid:"-mwldi9"}});p({and:[{clock:Z,fn:e=>(window.scrollTo(0,0),e),target:v}],or:{sid:"-lunkkc"}});N({store:we,pickup:j.appStarted});const{$scaleForm:ss,$isSubmitModalShown:A}=g,{submitScaleForm:ts,submitModalStateChanged:as}=L,os=J(async()=>{await ye("/free-report")},{name:"redirectToFreeReportPageFx",sid:"-r2e0tw"}),rs=J(async e=>{fe.show({color:"red",title:"Ошибка!",message:e})},{name:"showSubmitErrorFx",sid:"icm0c9"});p({and:[{clock:as,source:A,fn:e=>!e,target:A}],or:{sid:"6kdsv9"}});p({and:[{clock:ts,source:ss,target:w.start}],or:{sid:"6zs1hd"}});p({and:[{clock:w.finished.success,fn:()=>!1,target:A}],or:{sid:"732t1j"}});p({and:[{clock:w.finished.success,filter:()=>!(window!=null&&window.location.origin.includes("free-report")),fn:({result:e})=>e.id,target:g.$surveyId}],or:{sid:"7hx92a"}});p({and:[{clock:w.finished.success,filter:()=>!(window!=null&&window.location.origin.includes("free-report")),target:os}],or:{sid:"7xbhoe"}});p({and:[{clock:w.finished.failure,fn:e=>e.error.message,target:rs}],or:{sid:"80m98k"}});p({and:[{clock:g.$scaleForm,source:{questions:g.$preparedQuestions,form:g.$scaleForm},fn:({questions:e,form:{answers:s}})=>Number((s.length/((e==null?void 0:e.length)??0)*100).toFixed(0)),target:g.$currentProgress}],or:{sid:"-hdmfhh"}});N({store:g.$currentPage,pickup:j.appStarted});N({store:g.$scaleForm,pickup:j.appStarted});N({store:g.$currentProgress,pickup:j.appStarted});export{He as S,g as T,L as a,fs as g,Re as i};
